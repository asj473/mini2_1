<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.10/handlebars.min.js"></script>
<script src="/themat/lib/js/jquery.min.js"></script>
<script src="//cdn.ckeditor.com/4.7.1/basic/ckeditor.js"></script>

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="favicon.ico">

	<link href='https://fonts.googleapis.com/css?family=Playfair+Display:400,700,400italic,700italic|Merriweather:300,400italic,300italic,400,700italic' rel='stylesheet' type='text/css'>
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="/themat/lib/css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="/themat/lib/css/icomoon.css">
	<!-- Simple Line Icons -->
	<link rel="stylesheet" href="/themat/lib/css/simple-line-icons.css">
	<!-- Datetimepicker -->
	<link rel="stylesheet" href="/themat/lib/css/bootstrap-datetimepicker.min.css">
	<!-- Flexslider -->
	<link rel="stylesheet" href="/themat/lib/css/flexslider.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="/themat/lib/css/bootstrap.css">

	<link rel="stylesheet" href="/themat/lib/css/style.css">
	
	<script src="/themat/lib/js/modernizr-2.6.2.min.js"></script>

</head>
<body>
 <div id="fh5co-container">

	<div class="flexslider">
		<div class="fh5co-overlay"></div>
	</div>
		
	<div class="js-sticky">
		<div class="fh5co-main-nav">
			<div class="container-fluid">
				<div class="fh5co-menu-1">
					<a href="../../index.html" data-nav-section="home">home</a>
					<a href="#" data-nav-section="gallery">Gallery</a>
				</div>
				<div class="fh5co-logo">
					<a href="../../index.html">Themat</a>
				</div>
				<div class="fh5co-menu-2">
					<a href="#" data-nav-section="review">Review</a>
					<a href="#" data-nav-section="reservation">Q&A</a>
				</div>
			</div>
		</div>
	</div>

	 <div id="fh5co-menus" data-section="reservation">
	 
	 <div >
		<!--   여기서 부터 시작  -->
		<div id="ditail" class="container"></div>
		
	<!--  코멘트 시작 폼  -->
		<div id="comment" class="container">
			<form id="rForm" method="post" action="commentRegist.do">
				<table width="70%">
				<tr>
					<td><input type="text" name="userId" value="" /></td>
					<td><textarea name="content" rows="2" cols="50"></textarea></td>
					<td><input class="btn btn-primary btn-outline" type="submit" value="등록" /></td>
				</tr>	
				</table>
			</form>
		</div>
		
		<div id="commentList" class="container" ></div>
		
		
		
	</div> 
	 
	
	</div>	
	
</div>
 
 

	<!-- 디테일 핸들바 -->	
	<script id="entry-template" type="text/x-handlebars-template">
	<div class="container">
                 {{#list}} 
				<span>번호</span><span>{{no}}</span><span>날짜</span><span>{{regDate}}</span><br/>
                <span>제목</span><span>{{title}} </span> <br/>
				<span>글쓴이</span><span>{{writer}}</span> <br/>
				<span>내용</span><span>{{content}}</span> 
                 {{/list}} 
		</div>
     </script>

	<!-- 수정폼 핸들바 -->	
	<script id="update-template" type="text/x-handlebars-template">
	<form action='update.do' method='post' >
			{{#list}}
	  		<input type='hidden' name='no' value='{{no}}' />
	  제목 : 		<input type='text' name='title' value='{{title}}' /><br>
	  글쓴이 : 		<input type='text' name='writer' value='{{writer}}' /><br>
	  내용 : <br>
	 			<textarea id='ckk' name='content' rows='5' cols='70'>{{content}}</textarea><br>
				<input type='submit' value='등록' />
			{{/list}} 
		</form>
	<a href='listForm.do'>목록</a>
     </script>
	
	<div class="container">
		<button class="btn btn-primary btn-outline" type="button">삭제</button>
		<button class="btn btn-primary btn-outline" type="button">수정</button>
		<button class="btn btn-primary btn-outline" type="button">목록</button>
	</div>
		
	 
	 
 
 
 
 <div id="fh5co-footer">
	<div class="container">
		<div class="row row-padded">
			<div class="col-md-12 text-center">
				<p class="to-animate">&copy; 2016 Foodee Free HTML5 Template. <br> Designed by <a href="http://freehtml5.co/" target="_blank">FREEHTML5.co</a> Demo /themat/lib/images: <a href="http://pexels.com/" target="_blank">Pexels</a> <br> Tasty Icons Free <a href="http://handdrawngoods.com/store/tasty-icons-free-food-icons/" target="_blank">handdrawngoods</a>
				</p>
				<p class="text-center to-animate"><a href="#" class="js-gotop">Go To Top</a></p>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12 text-center">
				<ul class="fh5co-social">
					<li class="to-animate-2"><a href="#"><i class="icon-facebook"></i></a></li>
					<li class="to-animate-2"><a href="#"><i class="icon-twitter"></i></a></li>
					<li class="to-animate-2"><a href="#"><i class="icon-instagram"></i></a></li>
				</ul>
			</div>
		</div>
	</div>
</div>
 
 
 <script type="text/javascript">
 
 // url no값 파람 가져오기
 function getparam(paramName){
	 var url = window.location.search.substring(1); //url에서 처음부터 '?'까지 삭제
	var urlArray = url.split('&');
	 for(var i = 0 ; urlArray.length; i++){
		 var keyVal = urlArray[i].split('='); // '=' 을 기준으로 분리하기
		 if( keyVal[0] == paramName){  
			 // keyVal[0] : 파라미터 명
			 // keyVal[1] : 파라미터 값
			 return keyVal[1];
		 }
	 }
 }
 
 //댓글 리스트
 function commentList(){
	 $.ajax({
			url: "/themat/qna/commentList.do",
			data: {no: getparam('bno')},
			dataType: "json"
		}).done(makeCommentList);
 }
 
		
 function makeCommentList(result) {
		var html = "";
		html += "<table width='80%' border='1'>";

		for (var i = 0; i < result.length; i++) {
			var comment = result[i];
			html += "<tr id='row" + comment.commentNo + "'>";
			html += "<td>" + comment.userId + "</td>";
			html += "<td>" + comment.content + "</td>";
			
			var date = new Date(comment.regDate);
			var time = date.getFullYear() + "-"
			         + (date.getMonth() + 1) + "-"
			         + date.getDate() + " "
			         + date.getHours() + ":"
			         + date.getMinutes() + ":"
			         + date.getSeconds();
			html += "<td>" + time + "</td>";
			html += "<td>";
			html += "  <a href='javascript:commentDelete(" + comment.commentNo + ");'>삭제</a>";	
			html += "  <a href='javascript:commentUpdateForm(" + comment.commentNo + ");'>수정</a>";	
			html += "</td>";
			html += "</tr>";
			
		}
		if (result.length == 0) {
			html += "<tr>";
			html += "  <td colspan='4'>댓글이 존재하지 않습니다.</td>";
			html += "</tr>";
		}
		html += "</table>";
		
		$("#commentList").html(html);
	}
 
//댓글 등록 처리
	$("#rForm").submit(function () {
		$.ajax({
			url: "/themat/qna/commentRegist.do",
			type: "POST", 
			data: {
				no: getparam('bno'),
				content: $("#rForm textarea[name='content']").val(),
				userId: $("#rForm input[name='userId']").val()
			},
			dataType: "json"
		})
		.done(function (result) {
			// 입력폼 초기화 작업 
			// 로그인 안한 상태인 경우
			if(!'${user.id}') {
				$("#rForm input[name='userId']").val("");
			}
			$("#rForm textarea[name='content']").val("");
			
			makeCommentList(result);
		});
		return false;
	});
 
	//댓글 삭제 
	function commentDelete(commentNo) {
		$.ajax({
			url: "/themat/qna/commentDelete.do",
			data: {
				no: getparam('bno'),
				commentNo: commentNo,
				dataType: "json" 
			},
			dataType: "json"
		})
		.done(makeCommentList);
	}
 
	// 댓글 수정 
	function commentUpdateForm(commentNo) {
		// id가 row로 시작하는 모든 엘리먼트 ...
		$("#commentList tr[id ^= 'row']").show();
		$("#commentList tr[id ^= 'mod']").hide();
		
		var modId = $("#row" + commentNo + " > td:eq(0)").text();
		var modContent = $("#row" + commentNo + " > td:eq(1)").text();

		var html = "";
		html += "<tr id='modRow" + commentNo + "'>";
		html += "  <td>" + modId + "</td>";
		html += "  <td><textarea name='content'>" + modContent + "</textarea></td>";
		html += "  <td colspan='2'>";
		html += "    <a href='javascript:commentUpdate(" + commentNo + ");'>수정</a>";	
		html += "    <a href='javascript:commentCancel(" + commentNo + ");'>취소</a>";	
		html += "  </td>";
		html += "</tr>";
		
		// 해당 tr를 화면에서 숨긴다.
		$("#row" + commentNo).after(html);
		$("#row" + commentNo).hide();
	}
	function commentCancel(commentNo) {
		$("#row" + commentNo).show();
		$("#modRow" + commentNo).remove();
	}
	function commentUpdate(commentNo) {
		$.ajax({
			url: "commentUpdate.do",
			type: "POST",
			data: {
				no: getparam('bno'), 
				content: $("#modRow" + commentNo + " textarea[name=content]").val(), 
				commentNo: commentNo
			},
			dataType: "json"
		})
		.done(makeCommentList);
	}
	
 
 //디테일 정보 뿌리기
 $.ajax({
	url:"/themat/qna/dtail.do",
	data:{bno : getparam('bno')},
	dataType:'json'
 }).done(function(result){
	 var source = $("#entry-template").html(); 
		var template = Handlebars.compile(source); 	
		var html = template(result);
		$('#ditail').html(html);
		
	commentList()
 })
 
 
 
 //리스트 목록으로 가기
 $("button:eq(2)").click(function(){
	 location.href="/themat/qna/listForm.do";
 })
 
 //삭제
  $("button:eq(0)").click(function(){
	  $.ajax({
			url:"/themat/qna/delete.do",
			data:{bno : getparam('bno')},
		 }).done(function(){
			 location.href="/themat/qna/listForm.do";
		 })
 })
 
 //수정
  $("button:eq(1)").click(function(){
	  $.ajax({
			url:"/themat/qna/dtail.do",
			data:{bno : getparam('bno')},
			dataType:'json'
		 }).done(function(result){
			var source = $("#update-template").html(); 
			var template = Handlebars.compile(source); 
			var html = template(result);
			$('#ditail').html(html);
			
			 //ck에디터
		  CKEDITOR.replace("ckk");
		  
	})
 })
 
//  commentList()
 </script>
 <!-- jQuery -->
	<script src="/themat/lib/js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="/themat/lib/js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="/themat/lib/js/bootstrap.min.js"></script>
	<!-- Bootstrap DateTimePicker -->
	<script src="/themat/lib/js/moment.js"></script>
	<script src="/themat/lib/js/bootstrap-datetimepicker.min.js"></script>
	<!-- Waypoints -->
	<script src="/themat/lib/js/jquery.waypoints.min.js"></script>
	<!-- Stellar Parallax -->
	<script src="/themat/lib/js/jquery.stellar.min.js"></script>

	<!-- Flexslider -->
	<script src="/themat/lib/js/jquery.flexslider-min.js"></script>
	<script>
		$(function () {
	       $('#date').datetimepicker();
	   });
	</script>
	<!-- Main JS -->
	<script src="/themat/lib/js/main.js"></script>	
 
</body>
</html>